import{_ as w,c as d,a as t,d as h,e as b,F as N,i as y,t as n,n as f,L as v,s as x,m as i,y as r,v as _,M as D,z as g,N as M,g as k,D as C,f as m}from"./index-LfruuXpB.js";const S={name:"NodesView",setup(){return{dashboardStore:C()}},data(){return{nodes:[],loading:!0,showCreateModal:!1,editingNode:null,formData:{name:"",agent_url:"",wg_interface:"",endpoint:"",ip_pool_cidr:"",weight:100,max_peers:0,secret:"",enabled:!0}}},mounted(){this.loadNodes()},methods:{async loadNodes(){this.loading=!0,await k("/api/nodes",{},o=>{o.status?this.nodes=o.data||[]:this.dashboardStore.newMessage("Nodes",o.message||"Failed to load nodes","danger"),this.loading=!1})},editNode(o){this.editingNode=o,this.formData={name:o.name,agent_url:o.agent_url,wg_interface:o.wg_interface,endpoint:o.endpoint||"",ip_pool_cidr:o.ip_pool_cidr||"",weight:o.weight||100,max_peers:o.max_peers||0,enabled:o.enabled},this.showCreateModal=!0},async saveNode(){if(!this.formData.name||!this.formData.agent_url||!this.formData.wg_interface){this.dashboardStore.newMessage("Nodes","Please fill all required fields","warning");return}await(this.editingNode?()=>M(`/api/nodes/${this.editingNode.id}`,this.formData,this.handleSaveResponse):()=>g("/api/nodes",this.formData,this.handleSaveResponse))()},handleSaveResponse(o){o.status?(this.dashboardStore.newMessage("Nodes",o.message||"Node saved successfully","success"),this.closeModal(),this.loadNodes()):this.dashboardStore.newMessage("Nodes",o.message||"Failed to save node","danger")},async toggleNode(o){const e=!o.enabled;await g(`/api/nodes/${o.id}/toggle`,{enabled:e},u=>{u.status?(this.dashboardStore.newMessage("Nodes",u.message,"success"),this.loadNodes()):this.dashboardStore.newMessage("Nodes",u.message||"Failed to toggle node","danger")})},async testConnection(o){this.dashboardStore.newMessage("Nodes","Testing connection...","info"),await g(`/api/nodes/${o}/test`,{},e=>{const u=e.status?"success":"danger";this.dashboardStore.newMessage("Nodes",e.message,u)})},confirmDelete(o){confirm(`Are you sure you want to delete node "${o.name}"?`)&&this.deleteNode(o.id)},async deleteNode(o){await D(`/api/nodes/${o}`,{},e=>{e.status?(this.dashboardStore.newMessage("Nodes",e.message,"success"),this.loadNodes()):this.dashboardStore.newMessage("Nodes",e.message||"Failed to delete node","danger")})},closeModal(){this.showCreateModal=!1,this.editingNode=null,this.formData={name:"",agent_url:"",wg_interface:"",endpoint:"",ip_pool_cidr:"",weight:100,max_peers:0,secret:"",enabled:!0}},getStatusBadgeClass(o){if(!o.enabled)return"bg-secondary";try{const e=JSON.parse(o.health_json||"{}");if(e.status==="online")return"bg-success";if(e.status==="offline")return"bg-danger"}catch{}return"bg-warning"},getStatusText(o){if(!o.enabled)return"Disabled";try{const e=JSON.parse(o.health_json||"{}");if(e.status==="online")return"Online";if(e.status==="offline")return"Offline";if(e.status==="error")return"Error"}catch{}return"Unknown"},formatLastSeen(o){if(!o)return"Never";try{const e=new Date(o),p=new Date-e,l=Math.floor(p/6e4);return l<1?"Just now":l<60?`${l} min ago`:l<1440?`${Math.floor(l/60)} hours ago`:e.toLocaleString()}catch{return o}}}},U={class:"mt-5"},V={class:"container-fluid"},L={class:"d-flex align-items-center justify-content-between mb-4"},E={key:0,class:"text-center py-5"},P={key:1,class:"alert alert-info"},A={key:2,class:"row g-3"},I={class:"card h-100"},F={class:"card-body"},R={class:"d-flex justify-content-between align-items-start mb-3"},T={class:"card-title mb-0"},B={class:"mb-2"},j={class:"text-break"},q={class:"mb-2"},O={class:"text-break small"},z={class:"mb-2"},J={class:"text-break"},G={class:"mb-2"},W={class:"mb-2"},H={class:"d-flex gap-2 mt-3"},K=["onClick"],Q=["onClick"],X=["onClick","title"],Y=["onClick"],Z={class:"modal-dialog modal-lg"},$={class:"modal-content"},ee={class:"modal-header"},te={class:"modal-title"},se={class:"modal-body"},oe={class:"mb-3"},le={class:"mb-3"},ae={class:"mb-3"},ne={class:"mb-3"},ie={class:"mb-3"},de={class:"row"},re={class:"col-md-6 mb-3"},me={class:"col-md-6 mb-3"},ue={key:0,class:"mb-3"},be={class:"mb-3 form-check"},fe={class:"modal-footer"};function ce(o,e,u,p,l,a){return m(),d("div",U,[t("div",V,[t("div",L,[e[17]||(e[17]=t("h3",{class:"text-body mb-0"},[t("i",{class:"bi bi-hdd-network me-2"}),b("Nodes Management ")],-1)),t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=s=>l.showCreateModal=!0)},[...e[16]||(e[16]=[t("i",{class:"bi bi-plus-circle me-2"},null,-1),b("Add Node ",-1)])])]),l.loading?(m(),d("div",E,[...e[18]||(e[18]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1)])])):l.nodes.length===0?(m(),d("div",P,[...e[19]||(e[19]=[t("i",{class:"bi bi-info-circle me-2"},null,-1),b(" No nodes configured yet. Add your first node to enable multi-node management. ",-1)])])):(m(),d("div",A,[(m(!0),d(N,null,y(l.nodes,s=>(m(),d("div",{key:s.id,class:"col-12 col-md-6 col-lg-4"},[t("div",I,[t("div",F,[t("div",R,[t("h5",T,[e[20]||(e[20]=t("i",{class:"bi bi-hdd-network me-2"},null,-1)),b(n(s.name),1)]),t("span",{class:f(["badge",a.getStatusBadgeClass(s)])},n(a.getStatusText(s)),3)]),t("div",B,[e[21]||(e[21]=t("small",{class:"text-muted"},"Interface:",-1)),t("div",j,n(s.wg_interface),1)]),t("div",q,[e[22]||(e[22]=t("small",{class:"text-muted"},"Agent URL:",-1)),t("div",O,n(s.agent_url),1)]),t("div",z,[e[23]||(e[23]=t("small",{class:"text-muted"},"Endpoint:",-1)),t("div",J,n(s.endpoint||"N/A"),1)]),t("div",G,[e[24]||(e[24]=t("small",{class:"text-muted"},"IP Pool:",-1)),t("div",null,n(s.ip_pool_cidr||"N/A"),1)]),t("div",W,[e[25]||(e[25]=t("small",{class:"text-muted"},"Last Seen:",-1)),t("div",null,n(a.formatLastSeen(s.last_seen)),1)]),t("div",H,[t("button",{class:"btn btn-sm btn-outline-primary",onClick:c=>a.editNode(s),title:"Edit"},[...e[26]||(e[26]=[t("i",{class:"bi bi-pencil"},null,-1)])],8,K),t("button",{class:"btn btn-sm btn-outline-info",onClick:c=>a.testConnection(s.id),title:"Test Connection"},[...e[27]||(e[27]=[t("i",{class:"bi bi-plug"},null,-1)])],8,Q),t("button",{class:f(["btn btn-sm",s.enabled?"btn-outline-warning":"btn-outline-success"]),onClick:c=>a.toggleNode(s),title:s.enabled?"Disable":"Enable"},[t("i",{class:f(["bi",s.enabled?"bi-pause":"bi-play"])},null,2)],10,X),t("button",{class:"btn btn-sm btn-outline-danger",onClick:c=>a.confirmDelete(s),title:"Delete"},[...e[28]||(e[28]=[t("i",{class:"bi bi-trash"},null,-1)])],8,Y)])])])]))),128))])),t("div",{class:f(["modal fade",{show:l.showCreateModal}]),style:x({display:l.showCreateModal?"block":"none"}),tabindex:"-1",onClick:e[14]||(e[14]=v((...s)=>a.closeModal&&a.closeModal(...s),["self"]))},[t("div",Z,[t("div",$,[t("div",ee,[t("h5",te,n(l.editingNode?"Edit Node":"Add New Node"),1),t("button",{type:"button",class:"btn-close",onClick:e[1]||(e[1]=(...s)=>a.closeModal&&a.closeModal(...s))})]),t("div",se,[t("form",{onSubmit:e[11]||(e[11]=v((...s)=>a.saveNode&&a.saveNode(...s),["prevent"]))},[t("div",oe,[e[29]||(e[29]=t("label",{class:"form-label"},"Node Name *",-1)),i(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.formData.name=s),type:"text",class:"form-control",required:"",placeholder:"e.g., Node-EU-1"},null,512),[[r,l.formData.name]])]),t("div",le,[e[30]||(e[30]=t("label",{class:"form-label"},"Agent URL *",-1)),i(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.formData.agent_url=s),type:"url",class:"form-control",required:"",placeholder:"http://node1.example.com:8080"},null,512),[[r,l.formData.agent_url]]),e[31]||(e[31]=t("small",{class:"text-muted"},"Full URL to the node agent API",-1))]),t("div",ae,[e[32]||(e[32]=t("label",{class:"form-label"},"WireGuard Interface *",-1)),i(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.formData.wg_interface=s),type:"text",class:"form-control",required:"",placeholder:"wg0"},null,512),[[r,l.formData.wg_interface]])]),t("div",ne,[e[33]||(e[33]=t("label",{class:"form-label"},"Endpoint",-1)),i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.formData.endpoint=s),type:"text",class:"form-control",placeholder:"vpn.example.com:51820"},null,512),[[r,l.formData.endpoint]]),e[34]||(e[34]=t("small",{class:"text-muted"},"Public endpoint for clients to connect",-1))]),t("div",ie,[e[35]||(e[35]=t("label",{class:"form-label"},"IP Pool CIDR",-1)),i(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.formData.ip_pool_cidr=s),type:"text",class:"form-control",placeholder:"10.0.1.0/24"},null,512),[[r,l.formData.ip_pool_cidr]]),e[36]||(e[36]=t("small",{class:"text-muted"},"IP range for peer allocation on this node",-1))]),t("div",de,[t("div",re,[e[37]||(e[37]=t("label",{class:"form-label"},"Weight",-1)),i(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>l.formData.weight=s),type:"number",class:"form-control",min:"1",max:"1000"},null,512),[[r,l.formData.weight,void 0,{number:!0}]]),e[38]||(e[38]=t("small",{class:"text-muted"},"Load balancing weight (default: 100)",-1))]),t("div",me,[e[39]||(e[39]=t("label",{class:"form-label"},"Max Peers",-1)),i(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.formData.max_peers=s),type:"number",class:"form-control",min:"0"},null,512),[[r,l.formData.max_peers,void 0,{number:!0}]]),e[40]||(e[40]=t("small",{class:"text-muted"},"0 = unlimited",-1))])]),l.editingNode?h("",!0):(m(),d("div",ue,[e[41]||(e[41]=t("label",{class:"form-label"},"Shared Secret (optional)",-1)),i(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>l.formData.secret=s),type:"text",class:"form-control",placeholder:"Leave empty to auto-generate"},null,512),[[r,l.formData.secret]]),e[42]||(e[42]=t("small",{class:"text-muted"},"HMAC secret for agent authentication",-1))])),t("div",be,[i(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>l.formData.enabled=s),type:"checkbox",class:"form-check-input",id:"nodeEnabled"},null,512),[[_,l.formData.enabled]]),e[43]||(e[43]=t("label",{class:"form-check-label",for:"nodeEnabled"}," Enabled ",-1))])],32)]),t("div",fe,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[12]||(e[12]=(...s)=>a.closeModal&&a.closeModal(...s))},"Cancel"),t("button",{type:"button",class:"btn btn-primary",onClick:e[13]||(e[13]=(...s)=>a.saveNode&&a.saveNode(...s))},n(l.editingNode?"Update":"Create"),1)])])])],6),l.showCreateModal?(m(),d("div",{key:3,class:"modal-backdrop fade show",onClick:e[15]||(e[15]=(...s)=>a.closeModal&&a.closeModal(...s))})):h("",!0)])])}const pe=w(S,[["render",ce],["__scopeId","data-v-1a405931"]]);export{pe as default};
