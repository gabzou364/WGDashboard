import{_ as T,c as d,a as s,d as C,e as u,m as k,C as B,F as h,i as _,t as e,b as w,w as y,h as D,s as N,n as x,g as P,W as S,f as r}from"./index-LfruuXpB.js";const I={name:"TrafficMonitoringView",setup(){return{wireguardStore:S()}},data(){return{loading:!0,selectedConfig:"",topPeers:[],configTraffic:[],refreshInterval:null}},computed:{configurations(){return this.wireguardStore.Configurations||[]},totalTraffic(){return this.configTraffic.reduce((i,t)=>i+t.total,0)},totalUpload(){return this.configTraffic.reduce((i,t)=>i+t.upload,0)},totalDownload(){return this.configTraffic.reduce((i,t)=>i+t.download,0)},activePeers(){return this.topPeers.filter(i=>i.status==="running").length}},mounted(){this.loadTrafficData(),this.refreshInterval=setInterval(()=>{this.loadTrafficData()},1e4)},beforeUnmount(){this.refreshInterval&&clearInterval(this.refreshInterval)},methods:{async loadTrafficData(){this.loading=!0,this.wireguardStore.Configurations||await this.wireguardStore.getConfigurations();const i=this.selectedConfig?this.configurations.filter(n=>n.Name===this.selectedConfig):this.configurations,t=[],f=[];for(const n of i)await P("/api/getWireguardConfigurationInfo",{configurationName:n.Name},a=>{if(a.status&&a.data){const l=a.data.configurationPeers||[];let m=0,o=0,b=0;l.forEach(c=>{const g=(c.cumu_sent||0)+(c.total_sent||0),v=(c.cumu_receive||0)+(c.total_receive||0),p=g+v;m+=p,o+=g,b+=v,t.push({id:c.id,name:c.name,config:n.Name,total:p*1024*1024*1024,upload:g*1024*1024*1024,download:v*1024*1024*1024,status:c.status})}),f.push({name:n.Name,total:m*1024*1024*1024,upload:o*1024*1024*1024,download:b*1024*1024*1024,peers:l.length,status:n.Status})}});t.sort((n,a)=>a.total-n.total),this.topPeers=t.slice(0,20),f.sort((n,a)=>a.total-n.total),this.configTraffic=f,this.loading=!1},formatBytes(i){if(i===0)return"0 B";const t=1024,f=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(i)/Math.log(t));return Math.round(i/Math.pow(t,n)*100)/100+" "+f[n]}}},M={class:"mt-5"},U={class:"container-fluid"},V={class:"d-flex align-items-center justify-content-between mb-4"},A={class:"d-flex gap-2"},L=["value"],z=["disabled"],R={class:"row g-3 mb-4"},W={class:"col-md-3"},j={class:"card border-0 shadow-sm"},E={class:"card-body"},F={class:"d-flex align-items-center"},G={class:"mb-0"},K={class:"col-md-3"},q={class:"card border-0 shadow-sm"},H={class:"card-body"},J={class:"d-flex align-items-center"},O={class:"mb-0"},Q={class:"col-md-3"},X={class:"card border-0 shadow-sm"},Y={class:"card-body"},Z={class:"d-flex align-items-center"},$={class:"mb-0"},ss={class:"col-md-3"},ts={class:"card border-0 shadow-sm"},os={class:"card-body"},ls={class:"d-flex align-items-center"},es={class:"mb-0"},as={class:"card mb-4"},is={class:"card-body"},ns={key:0,class:"text-center py-5"},ds={key:1,class:"text-muted text-center py-5"},rs={key:2,class:"table-responsive"},cs={class:"table table-hover align-middle mb-0"},us={class:"text-muted"},fs={class:"progress mt-1",style:{height:"4px"}},ms={class:"text-success"},bs={class:"text-info"},gs={key:0,class:"card"},vs={class:"card-body"},hs={class:"row g-3"},_s={class:"card h-100 border"},ps={class:"card-body"},ws={class:"card-title"},ys={class:"mb-2"},xs={class:"mb-0"},Ts={class:"row g-2"},Cs={class:"col-6"},ks={class:"text-success"},Bs={class:"col-6"},Ds={class:"text-info"},Ns={class:"d-flex justify-content-between align-items-center"},Ps={class:"text-muted"},Ss={class:"text-muted"};function Is(i,t,f,n,a,l){const m=D("RouterLink");return r(),d("div",M,[s("div",U,[s("div",V,[t[5]||(t[5]=s("h3",{class:"text-body mb-0"},[s("i",{class:"bi bi-graph-up me-2"}),u("Traffic Monitoring ")],-1)),s("div",A,[k(s("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>a.selectedConfig=o),class:"form-select form-select-sm",onChange:t[1]||(t[1]=(...o)=>l.loadTrafficData&&l.loadTrafficData(...o))},[t[3]||(t[3]=s("option",{value:""},"All Configurations",-1)),(r(!0),d(h,null,_(l.configurations,o=>(r(),d("option",{key:o.Name,value:o.Name},e(o.Name),9,L))),128))],544),[[B,a.selectedConfig]]),s("button",{class:"btn btn-sm btn-outline-secondary",onClick:t[2]||(t[2]=(...o)=>l.loadTrafficData&&l.loadTrafficData(...o)),disabled:a.loading},[...t[4]||(t[4]=[s("i",{class:"bi bi-arrow-repeat me-1"},null,-1),u("Refresh ",-1)])],8,z)])]),s("div",R,[s("div",W,[s("div",j,[s("div",E,[s("div",F,[t[7]||(t[7]=s("div",{class:"stat-icon bg-primary-subtle text-primary rounded-3 p-2 me-3"},[s("i",{class:"bi bi-arrow-down-up fs-5"})],-1)),s("div",null,[t[6]||(t[6]=s("small",{class:"text-muted d-block"},"Total Traffic",-1)),s("h5",G,e(l.formatBytes(l.totalTraffic)),1)])])])])]),s("div",K,[s("div",q,[s("div",H,[s("div",J,[t[9]||(t[9]=s("div",{class:"stat-icon bg-success-subtle text-success rounded-3 p-2 me-3"},[s("i",{class:"bi bi-arrow-up fs-5"})],-1)),s("div",null,[t[8]||(t[8]=s("small",{class:"text-muted d-block"},"Total Upload",-1)),s("h5",O,e(l.formatBytes(l.totalUpload)),1)])])])])]),s("div",Q,[s("div",X,[s("div",Y,[s("div",Z,[t[11]||(t[11]=s("div",{class:"stat-icon bg-info-subtle text-info rounded-3 p-2 me-3"},[s("i",{class:"bi bi-arrow-down fs-5"})],-1)),s("div",null,[t[10]||(t[10]=s("small",{class:"text-muted d-block"},"Total Download",-1)),s("h5",$,e(l.formatBytes(l.totalDownload)),1)])])])])]),s("div",ss,[s("div",ts,[s("div",os,[s("div",ls,[t[13]||(t[13]=s("div",{class:"stat-icon bg-warning-subtle text-warning rounded-3 p-2 me-3"},[s("i",{class:"bi bi-people fs-5"})],-1)),s("div",null,[t[12]||(t[12]=s("small",{class:"text-muted d-block"},"Active Peers",-1)),s("h5",es,e(l.activePeers),1)])])])])])]),s("div",as,[t[19]||(t[19]=s("div",{class:"card-header bg-transparent"},[s("h5",{class:"mb-0"},[s("i",{class:"bi bi-bar-chart-fill me-2"}),u("Top Peers by Traffic ")])],-1)),s("div",is,[a.loading?(r(),d("div",ns,[...t[14]||(t[14]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1)])])):a.topPeers.length===0?(r(),d("div",ds," No traffic data available ")):(r(),d("div",rs,[s("table",cs,[t[18]||(t[18]=s("thead",{class:"table-light"},[s("tr",null,[s("th",{style:{width:"50px"}},"#"),s("th",null,"Peer Name"),s("th",null,"Configuration"),s("th",null,"Total Traffic"),s("th",null,"Upload"),s("th",null,"Download"),s("th",null,"Status")])],-1)),s("tbody",null,[(r(!0),d(h,null,_(a.topPeers,(o,b)=>(r(),d("tr",{key:o.id},[s("td",null,e(b+1),1),s("td",null,[s("strong",null,e(o.name||"Untitled Peer"),1),t[15]||(t[15]=s("br",null,null,-1)),s("small",us,[s("samp",null,e(o.id.substring(0,20))+"...",1)])]),s("td",null,[w(m,{to:`/configuration/${o.config}/peers`,class:"text-decoration-none"},{default:y(()=>[s("samp",null,e(o.config),1)]),_:2},1032,["to"])]),s("td",null,[s("strong",null,e(l.formatBytes(o.total)),1),s("div",fs,[s("div",{class:"progress-bar bg-primary",style:N({width:o.total/a.topPeers[0].total*100+"%"})},null,4)])]),s("td",ms,[t[16]||(t[16]=s("i",{class:"bi bi-arrow-up me-1"},null,-1)),u(" "+e(l.formatBytes(o.upload)),1)]),s("td",bs,[t[17]||(t[17]=s("i",{class:"bi bi-arrow-down me-1"},null,-1)),u(" "+e(l.formatBytes(o.download)),1)]),s("td",null,[s("span",{class:x(["badge",o.status==="running"?"bg-success":"bg-secondary"])},e(o.status==="running"?"Active":"Inactive"),3)])]))),128))])])]))])]),a.selectedConfig?C("",!0):(r(),d("div",gs,[t[27]||(t[27]=s("div",{class:"card-header bg-transparent"},[s("h5",{class:"mb-0"},[s("i",{class:"bi bi-pie-chart-fill me-2"}),u("Traffic by Configuration ")])],-1)),s("div",vs,[s("div",hs,[(r(!0),d(h,null,_(a.configTraffic,o=>(r(),d("div",{key:o.name,class:"col-md-6 col-lg-4"},[s("div",_s,[s("div",ps,[s("h6",ws,[w(m,{to:`/configuration/${o.name}/peers`,class:"text-decoration-none"},{default:y(()=>[s("samp",null,e(o.name),1)]),_:2},1032,["to"])]),s("div",ys,[t[20]||(t[20]=s("small",{class:"text-muted"},"Total Traffic",-1)),s("h5",xs,e(l.formatBytes(o.total)),1)]),s("div",Ts,[s("div",Cs,[t[22]||(t[22]=s("small",{class:"text-muted d-block"},"Upload",-1)),s("small",ks,[t[21]||(t[21]=s("i",{class:"bi bi-arrow-up me-1"},null,-1)),s("strong",null,e(l.formatBytes(o.upload)),1)])]),s("div",Bs,[t[24]||(t[24]=s("small",{class:"text-muted d-block"},"Download",-1)),s("small",Ds,[t[23]||(t[23]=s("i",{class:"bi bi-arrow-down me-1"},null,-1)),s("strong",null,e(l.formatBytes(o.download)),1)])])]),t[26]||(t[26]=s("hr",null,null,-1)),s("div",Ns,[s("small",Ps,[t[25]||(t[25]=s("i",{class:"bi bi-people me-1"},null,-1)),u(" "+e(o.peers)+" peers ",1)]),s("small",Ss,[s("span",{class:x(["badge",o.status?"bg-success":"bg-secondary"])},e(o.status?"Active":"Inactive"),3)])])])])]))),128))])])]))])])}const Us=T(I,[["render",Is],["__scopeId","data-v-925d0957"]]);export{Us as default};
