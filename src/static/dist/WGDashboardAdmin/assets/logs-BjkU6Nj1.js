import{_ as p,c as d,a as e,d as b,e as r,m,C as c,O as f,y as v,F as y,i as _,n as g,t as n,L,g as h,D as x,f as a}from"./index-LfruuXpB.js";const C={name:"LogsView",setup(){return{dashboardStore:x()}},data(){return{logs:[],selectedLog:null,loading:!0,filters:{action:"",entity_type:"",entity_id:"",limit:100,offset:0},debounceTimer:null}},mounted(){this.loadLogs(),this.refreshInterval=setInterval(()=>{this.loadLogs()},3e4)},beforeUnmount(){this.refreshInterval&&clearInterval(this.refreshInterval),this.debounceTimer&&clearTimeout(this.debounceTimer)},methods:{async loadLogs(){this.loading=!0;const o={};this.filters.action&&(o.action=this.filters.action),this.filters.entity_type&&(o.entity_type=this.filters.entity_type),this.filters.entity_id&&(o.entity_id=this.filters.entity_id),o.limit=this.filters.limit,o.offset=this.filters.offset;const t=new URLSearchParams(o).toString();await h(`/api/audit-logs?${t}`,{},u=>{u.status&&u.data?this.logs=u.data:this.logs=[],this.loading=!1})},debouncedLoadLogs(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.loadLogs()},500)},clearFilters(){this.filters={action:"",entity_type:"",entity_id:"",limit:100,offset:0},this.loadLogs()},nextPage(){this.filters.offset+=this.filters.limit,this.loadLogs()},previousPage(){this.filters.offset=Math.max(0,this.filters.offset-this.filters.limit),this.loadLogs()},formatTimestamp(o){return o?new Date(o).toLocaleString():"N/A"},truncateDetails(o){if(!o)return"N/A";const t=100;return o.length<=t?o:o.substring(0,t)+"..."},formatDetails(o){if(!o)return"N/A";try{const t=JSON.parse(o);return JSON.stringify(t,null,2)}catch{return o}},getActionBadgeClass(o){return{node_assigned:"bg-success",node_removed:"bg-danger",peer_migrated:"bg-warning",dns_updated:"bg-info",endpoint_group_updated:"bg-primary",peer_created:"bg-success",peer_deleted:"bg-danger"}[o]||"bg-secondary"}}},k={class:"mt-5"},w={class:"container-fluid"},D={class:"d-flex align-items-center justify-content-between mb-4"},T={class:"d-flex gap-2"},N=["disabled"],S={class:"card mb-4"},A={class:"card-body"},P={class:"row g-3"},E={class:"col-md-3"},I={class:"col-md-3"},U={class:"col-md-3"},V={class:"col-md-3"},M={key:0,class:"text-center py-5"},B={key:1,class:"alert alert-info"},F={key:2,class:"card"},R={class:"card-body p-0"},j={class:"table-responsive"},G={class:"table table-hover mb-0"},O=["onClick"],J={class:"badge bg-secondary"},q={class:"small"},z={class:"text-muted"},H={class:"card-footer d-flex justify-content-between align-items-center"},K={class:"text-muted small"},Q={class:"d-flex gap-2"},W=["disabled"],X=["disabled"],Y={class:"modal-dialog modal-lg"},Z={class:"modal-content"},$={class:"modal-header"},ee={class:"modal-body"},te={class:"row g-3"},se={class:"col-md-6"},le={class:"col-md-6"},oe={class:"col-md-6"},ie={class:"col-md-6"},ne={class:"badge bg-secondary"},de={class:"col-12"},ae={class:"col-12"},re={class:"col-12"},ue={class:"bg-light p-3 rounded"},me={class:"modal-footer"};function ce(o,t,u,ge,l,i){return a(),d("div",k,[e("div",w,[e("div",D,[t[18]||(t[18]=e("h3",{class:"text-body mb-0"},[e("i",{class:"bi bi-journal-text me-2"}),r("System Logs & Diagnostics ")],-1)),e("div",T,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:t[0]||(t[0]=(...s)=>i.loadLogs&&i.loadLogs(...s)),disabled:l.loading},[...t[16]||(t[16]=[e("i",{class:"bi bi-arrow-repeat me-1"},null,-1),r("Refresh ",-1)])],8,N),e("button",{class:"btn btn-sm btn-outline-danger",onClick:t[1]||(t[1]=(...s)=>i.clearFilters&&i.clearFilters(...s))},[...t[17]||(t[17]=[e("i",{class:"bi bi-x-circle me-1"},null,-1),r("Clear Filters ",-1)])])])]),e("div",S,[e("div",A,[e("div",P,[e("div",E,[t[20]||(t[20]=e("label",{class:"form-label small text-muted"},"Action Type",-1)),m(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.filters.action=s),class:"form-select form-select-sm",onChange:t[3]||(t[3]=(...s)=>i.loadLogs&&i.loadLogs(...s))},[...t[19]||(t[19]=[f('<option value="" data-v-8ed67215>All Actions</option><option value="node_assigned" data-v-8ed67215>Node Assigned</option><option value="node_removed" data-v-8ed67215>Node Removed</option><option value="peer_migrated" data-v-8ed67215>Peer Migrated</option><option value="dns_updated" data-v-8ed67215>DNS Updated</option><option value="endpoint_group_updated" data-v-8ed67215>Endpoint Group Updated</option><option value="peer_created" data-v-8ed67215>Peer Created</option><option value="peer_deleted" data-v-8ed67215>Peer Deleted</option>',8)])],544),[[c,l.filters.action]])]),e("div",I,[t[22]||(t[22]=e("label",{class:"form-label small text-muted"},"Entity Type",-1)),m(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>l.filters.entity_type=s),class:"form-select form-select-sm",onChange:t[5]||(t[5]=(...s)=>i.loadLogs&&i.loadLogs(...s))},[...t[21]||(t[21]=[f('<option value="" data-v-8ed67215>All Entities</option><option value="config_node" data-v-8ed67215>Config-Node</option><option value="peer" data-v-8ed67215>Peer</option><option value="endpoint_group" data-v-8ed67215>Endpoint Group</option><option value="dns_record" data-v-8ed67215>DNS Record</option>',5)])],544),[[c,l.filters.entity_type]])]),e("div",U,[t[23]||(t[23]=e("label",{class:"form-label small text-muted"},"Entity ID",-1)),m(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>l.filters.entity_id=s),type:"text",class:"form-control form-control-sm",placeholder:"e.g., wg0:node1",onInput:t[7]||(t[7]=(...s)=>i.debouncedLoadLogs&&i.debouncedLoadLogs(...s))},null,544),[[v,l.filters.entity_id]])]),e("div",V,[t[25]||(t[25]=e("label",{class:"form-label small text-muted"},"Results per page",-1)),m(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>l.filters.limit=s),class:"form-select form-select-sm",onChange:t[9]||(t[9]=(...s)=>i.loadLogs&&i.loadLogs(...s))},[...t[24]||(t[24]=[e("option",{value:50},"50",-1),e("option",{value:100},"100",-1),e("option",{value:200},"200",-1),e("option",{value:500},"500",-1)])],544),[[c,l.filters.limit,void 0,{number:!0}]])])])])]),l.loading?(a(),d("div",M,[...t[26]||(t[26]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)])])):l.logs.length===0?(a(),d("div",B,[...t[27]||(t[27]=[e("i",{class:"bi bi-info-circle me-2"},null,-1),r(" No logs found matching the current filters. ",-1)])])):(a(),d("div",F,[e("div",R,[e("div",j,[e("table",G,[t[28]||(t[28]=e("thead",{class:"table-light"},[e("tr",null,[e("th",{style:{width:"180px"}},"Timestamp"),e("th",{style:{width:"150px"}},"Action"),e("th",{style:{width:"120px"}},"Entity Type"),e("th",null,"Entity ID"),e("th",null,"Details"),e("th",{style:{width:"100px"}},"User")])],-1)),e("tbody",null,[(a(!0),d(y,null,_(l.logs,s=>(a(),d("tr",{key:s.id,style:{cursor:"pointer"},onClick:be=>l.selectedLog=s,class:g({"table-active":l.selectedLog&&l.selectedLog.id===s.id})},[e("td",null,[e("small",null,n(i.formatTimestamp(s.timestamp)),1)]),e("td",null,[e("span",{class:g(["badge",i.getActionBadgeClass(s.action)])},n(s.action),3)]),e("td",null,[e("span",J,n(s.entity_type),1)]),e("td",null,[e("code",q,n(s.entity_id||"N/A"),1)]),e("td",null,[e("small",z,n(i.truncateDetails(s.details)),1)]),e("td",null,[e("small",null,n(s.user||"system"),1)])],10,O))),128))])])])]),e("div",H,[e("div",K," Showing "+n(l.logs.length)+" entries ",1),e("div",Q,[e("button",{class:"btn btn-sm btn-outline-primary",disabled:l.filters.offset===0,onClick:t[10]||(t[10]=(...s)=>i.previousPage&&i.previousPage(...s))},[...t[29]||(t[29]=[e("i",{class:"bi bi-chevron-left"},null,-1),r(" Previous ",-1)])],8,W),e("button",{class:"btn btn-sm btn-outline-primary",disabled:l.logs.length<l.filters.limit,onClick:t[11]||(t[11]=(...s)=>i.nextPage&&i.nextPage(...s))},[...t[30]||(t[30]=[r(" Next ",-1),e("i",{class:"bi bi-chevron-right"},null,-1)])],8,X)])])])),l.selectedLog?(a(),d("div",{key:3,class:"modal fade show d-block",tabindex:"-1",onClick:t[14]||(t[14]=L(s=>l.selectedLog=null,["self"]))},[e("div",Y,[e("div",Z,[e("div",$,[t[31]||(t[31]=e("h5",{class:"modal-title"},"Log Entry Details",-1)),e("button",{type:"button",class:"btn-close",onClick:t[12]||(t[12]=s=>l.selectedLog=null)})]),e("div",ee,[e("div",te,[e("div",se,[t[32]||(t[32]=e("label",{class:"form-label small text-muted"},"ID",-1)),e("div",null,[e("code",null,n(l.selectedLog.id),1)])]),e("div",le,[t[33]||(t[33]=e("label",{class:"form-label small text-muted"},"Timestamp",-1)),e("div",null,n(i.formatTimestamp(l.selectedLog.timestamp)),1)]),e("div",oe,[t[34]||(t[34]=e("label",{class:"form-label small text-muted"},"Action",-1)),e("div",null,[e("span",{class:g(["badge",i.getActionBadgeClass(l.selectedLog.action)])},n(l.selectedLog.action),3)])]),e("div",ie,[t[35]||(t[35]=e("label",{class:"form-label small text-muted"},"Entity Type",-1)),e("div",null,[e("span",ne,n(l.selectedLog.entity_type),1)])]),e("div",de,[t[36]||(t[36]=e("label",{class:"form-label small text-muted"},"Entity ID",-1)),e("div",null,[e("code",null,n(l.selectedLog.entity_id||"N/A"),1)])]),e("div",ae,[t[37]||(t[37]=e("label",{class:"form-label small text-muted"},"User",-1)),e("div",null,n(l.selectedLog.user||"system"),1)]),e("div",re,[t[38]||(t[38]=e("label",{class:"form-label small text-muted"},"Details",-1)),e("pre",ue,[e("code",null,n(i.formatDetails(l.selectedLog.details)),1)])])])]),e("div",me,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[13]||(t[13]=s=>l.selectedLog=null)},"Close")])])])])):b("",!0),l.selectedLog?(a(),d("div",{key:4,class:"modal-backdrop fade show",onClick:t[15]||(t[15]=s=>l.selectedLog=null)})):b("",!0)])])}const pe=p(C,[["render",ce],["__scopeId","data-v-8ed67215"]]);export{pe as default};
